<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>DI.DAY Image Generator</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <style>
            body {
                font-family:
                    system-ui,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    sans-serif;
                background: #2b0033;
                color: #fff;
                margin: 0;
                padding: 0;
                display: grid;
                grid-template-columns: 320px 1fr;
                min-height: 100vh;
            }
            aside {
                background: #3a0047;
                padding: 16px;
                box-shadow: inset -2px 0 0 rgba(0, 0, 0, 0.3);
            }
            aside h2 {
                margin-top: 0;
                font-size: 1.1rem;
            }
            label {
                display: block;
                margin-top: 12px;
                font-size: 0.85rem;
                opacity: 0.9;
            }
            input,
            textarea,
            select,
            button {
                width: 100%;
                margin-top: 6px;
                padding: 8px;
                border-radius: 8px;
                border: none;
                font-size: 0.9rem;
            }
            textarea {
                resize: vertical;
            }
            button {
                margin-top: 16px;
                background: #ffb400;
                color: #4b005c;
                font-weight: 700;
                cursor: pointer;
            }
            main {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 24px;
            }

            /* Poster */
            #poster {
                width: 360px;
                aspect-ratio: 9 / 16;
                position: relative;
                overflow: hidden;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                background: #000;
            }

            .overlay {
                position: absolute;
                left: 0;
                width: 100%;
                pointer-events: none;
                z-index: 5;
            }
            .overlay.top {
                top: 0;
            }
            .overlay.bottom {
                bottom: 0;
            }

            .image-area {
                position: absolute;
                inset: 0;
                z-index: 1;
            }
            .image-area img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transform-origin: center;
                transition: transform 0.1s ease-out;
            }

            .headline {
                position: absolute;
                left: 16px;
                right: 16px;
                bottom: 110px;
                z-index: 3;
                background: rgba(255, 180, 0, 0.92);
                color: #6a007d;
                padding: 14px;
                border-radius: 14px;
                text-align: center;
            }
            .headline-main {
                font-size: 1.25rem;
                font-weight: 900;
                line-height: 1.15;
            }
            .headline-sub {
                font-size: 0.75rem;
                font-weight: 700;
                margin-top: 6px;
            }
        </style>
    </head>
    <body>
        <aside>
            <h2>Poster Settings</h2>

            <label
                >Upload Image
                <input type="file" accept="image/*" id="imageUpload" />
            </label>

            <label
                >Zoom
                <input
                    type="range"
                    min="100"
                    max="300"
                    value="100"
                    id="zoomSlider"
                />
            </label>

            <label
                >Position X
                <input
                    type="range"
                    min="-100"
                    max="100"
                    value="0"
                    id="posXSlider"
                />
            </label>

            <label
                >Position Y
                <input
                    type="range"
                    min="-100"
                    max="100"
                    value="0"
                    id="posYSlider"
                />
            </label>

            <label
                >Main Headline
                <textarea id="headlineText">Digital Independence Day</textarea>
            </label>

            <label
                >Subtitle
                <input
                    type="text"
                    id="subtitleText"
                    value="Jeden ersten Sonntag digital freier werden!"
                />
            </label>

            <button id="downloadBtn">Download PNG</button>
        </aside>

        <main>
            <div id="poster">
                <div class="image-area">
                    <img id="posterImage" />
                </div>

                <div class="headline">
                    <div class="headline-main" id="headlinePreview">
                        Digital Independence Day
                    </div>
                    <div class="headline-sub" id="subtitlePreview">
                        Jeden ersten Sonntag digital freier werden!
                    </div>
                </div>

                <!-- Overlays -->
                <img src="diday.png" class="overlay top" />
                <img src="diday.png" class="overlay bottom" />
            </div>
        </main>

        <script>
            const imgEl = document.getElementById("posterImage");
            let zoom = 100;
            let posX = 0;
            let posY = 0;

            function updateImageTransform() {
                const scale = zoom / 100;
                imgEl.style.transform = `scale(${scale}) translate(${posX}%, ${posY}%)`;
            }

            document
                .getElementById("imageUpload")
                .addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = () => (imgEl.src = reader.result);
                    reader.readAsDataURL(file);
                });

            document
                .getElementById("zoomSlider")
                .addEventListener("input", (e) => {
                    zoom = e.target.value;
                    updateImageTransform();
                });

            document
                .getElementById("posXSlider")
                .addEventListener("input", (e) => {
                    posX = e.target.value;
                    updateImageTransform();
                });

            document
                .getElementById("posYSlider")
                .addEventListener("input", (e) => {
                    posY = e.target.value;
                    updateImageTransform();
                });

            document
                .getElementById("headlineText")
                .addEventListener("input", (e) => {
                    document.getElementById("headlinePreview").textContent =
                        e.target.value;
                });

            document
                .getElementById("subtitleText")
                .addEventListener("input", (e) => {
                    document.getElementById("subtitlePreview").textContent =
                        e.target.value;
                });

            // Helper: Calculate object-fit: cover dimensions
            function getCoverSize(img, containerW, containerH) {
                const ratio = img.naturalWidth / img.naturalHeight;
                const containerRatio = containerW / containerH;
                if (ratio > containerRatio) {
                    return { width: containerH * ratio, height: containerH };
                }
                return { width: containerW, height: containerW / ratio };
            }

            // Helper: Draw overlay image
            function drawOverlay(ctx, overlay, posterW, posterH) {
                if (!overlay.complete) return;
                const aspectRatio =
                    overlay.naturalWidth / overlay.naturalHeight;
                const scaledHeight = posterW / aspectRatio;
                const y = overlay.classList.contains("top")
                    ? 0
                    : posterH - scaledHeight;
                ctx.drawImage(overlay, 0, y, posterW, scaledHeight);
            }

            document
                .getElementById("downloadBtn")
                .addEventListener("click", () => {
                    const poster = document.getElementById("poster");
                    const posterImg = document.getElementById("posterImage");
                    const headlineEl = document.querySelector(".headline");
                    const scale = 2;

                    // Setup canvas
                    const canvas = document.createElement("canvas");
                    canvas.width = poster.offsetWidth * scale;
                    canvas.height = poster.offsetHeight * scale;
                    const ctx = canvas.getContext("2d");
                    ctx.scale(scale, scale);

                    const w = poster.offsetWidth;
                    const h = poster.offsetHeight;

                    // Background
                    ctx.fillStyle = "#000";
                    ctx.fillRect(0, 0, w, h);

                    // Main image with aspect ratio preserved
                    if (posterImg.src && posterImg.complete) {
                        const cover = getCoverSize(posterImg, w, h);
                        const imgW = cover.width * (zoom / 100);
                        const imgH = cover.height * (zoom / 100);
                        const imgX = (w - imgW) / 2 + (posX / 100) * imgW;
                        const imgY = (h - imgH) / 2 + (posY / 100) * imgH;
                        ctx.drawImage(posterImg, imgX, imgY, imgW, imgH);
                    }

                    // Get headline position from DOM
                    const rect = headlineEl.getBoundingClientRect();
                    const posterRect = poster.getBoundingClientRect();
                    const hX = rect.left - posterRect.left;
                    const hY = rect.top - posterRect.top;
                    const hW = rect.width;
                    const hH = rect.height;

                    // Headline box
                    ctx.fillStyle = "rgba(255, 180, 0, 0.92)";
                    ctx.beginPath();
                    ctx.roundRect(hX, hY, hW, hH, 14);
                    ctx.fill();

                    // Text
                    ctx.fillStyle = "#6a007d";
                    ctx.textAlign = "center";
                    ctx.font = "900 1.25rem system-ui, sans-serif";
                    ctx.fillText(
                        document.getElementById("headlineText").value,
                        w / 2,
                        hY + 22,
                    );
                    ctx.font = "700 0.75rem system-ui, sans-serif";
                    ctx.fillText(
                        document.getElementById("subtitleText").value,
                        w / 2,
                        hY + 40,
                    );

                    document.querySelectorAll(".overlay").forEach((overlay) => {
                        drawOverlay(ctx, overlay, w, h);
                    });

                    const link = document.createElement("a");
                    link.download = "diday.png";
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });
        </script>
    </body>
</html>
